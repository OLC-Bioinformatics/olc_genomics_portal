{% extends "base.html" %}
{#Head container#}
{% load staticfiles %}
{% load bootstrap %}
{% load i18n widget_tweaks %}
<script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script>
{% block content %}
<h2>AMR Summary Results for {{ amr_detail.seqid }}</h2>
<br>
<button class="btn btn-success btn-block" disabled>{{ amr_request.status }} <i class="fas fa-check-circle"></i></button>
<br>
<p>These results will be available for 7 days.</p>
<br>
  <div class="dropdown">
     <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown">
       Select Sequence to View Results
     </button>
     <div class="dropdown-menu">
       {% for amr_detail in amr_request.amrdetail.all %}
          <a class="dropdown-item" href="{% url 'geneseekr:amr_detail' amr_detail_pk=amr_detail.pk %}">{{ amr_detail.seqid }}</a>
       {% endfor %}
     </div>
  <br>
  </div>
    <table class="table">
    <thead>
      <tr>
        <th>Gene</th>
        <th>Location</th>
      </tr>
    </thead>
    <tbody>
    {% for gene, location in amr_detail.amr_results.items %}
      <tr>
         <td>{{ gene }}</td>
         {% if location == 'chromosome' %}
           <td class="table-secondary">{{ location }}</td>
         {% else %}
           <td class="table-info">Plasmid {{ location }}</td>
         {% endif %}
      </tr>
    {% endfor %}
    </tbody>
    </table>
<br>
<br>
<br>
<div style="text-align: center">
  <a href="{{ amr_request.download_link }}" class="btn btn-outline-dark" role="button"><i class="fas fa-download"></i>
    Download Summary</a>
  <br>
  <br>
  <div class="alert alert-primary" role="alert" align="center">
    <p style="word-wrap:break-word;"><i class="fas fa-share-alt"></i><b> Shareable link:</b> {{ amr_request.download_link }}</p>
  </div>
</div>

<script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
<script type="text/javascript">
var toggle = document.getElementById('toggle');
 // If page load is post, change sequence titles to toggle of choice
  $(document).ready(function () {
    if ((document.getElementById('seqID').value) != 'None'){
    toggleFunc(toggle);
    }
  });
  // Finds Toggle button, checks value, changes button value + display then alters list of sequences displays
  function toggleFunc () {
      var btn = document.getElementById('toggle-vis');
      if (btn.value === 'Lab') {
        toggle.value = 'Lab';
        btn.value= 'Both';
        btn.innerHTML ='View Both';
        {% for key,value in labidDict.items%}
         var i = document.getElementById('{{key}}');
         i.innerHTML = '{{value}}';
        {% endfor%};
      } else if (btn.value === 'Both') {
        toggle.value = 'Both';
        btn.value ='Seq';
        btn.innerHTML ='View SeqIDs';
        {% for key,value in labidDict.items%}
         var i = document.getElementById('{{key}}');
         i.innerHTML = '{{key}} {{value}}';
        {% endfor%};
      } else {
        toggle.value = 'Seq';
        btn.value ='Lab';
        btn.innerHTML ='View LabIDs';
        {% for key,value in labidDict.items%}
        var i = document.getElementById('{{key}}');
        i.innerHTML = '{{key}}';
        {% endfor%};
      }
    };
  
  setInterval(function () {
    {% if amr_request.status == 'Processing' %}
    window.location = window.location.href; 
    {% endif %}
  }, 45000) // Refresh every 45 seconds

// Called when sequence list items are selected, chosen seq value is assigned and page is submitted
  function Func(x) {
    var input = document.getElementById('seqID');
    input.value = x;
    document.getElementById('seqForm').submit();
  }
</script>
{% endblock %}
